<!doctype html>
<html>
  <head>
    <title>Drum Stick</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
    <script src='/socket.io/socket.io.js'></script>
    <script>var socket = io.connect('/');</script>
  </head>
  <body>
    <h1> Phone view</h1>

    <script>

      var prev = 0;
      var hit = true;
      var sendHit = function(action){
        console.log(action);
        socket.emit('action', action);
      };

      $(document).on('vclick', document, function(){
        sendHit('snare');
      });

      if(window.DeviceOrientationEvent) {
        window.addEventListener("deviceorientation", function(event) {
          var frontToBack = event.beta;
          var rotateDegrees = event.alpha;
          checkHit(frontToBack, rotateDegrees);
        }, false);
      }

      function checkHit(o) {
        var z = (Math.round(z));
        var o = (Math.round(o));

        if(hit) {
          if(z > prev && prev < 0){
            socket.emit('action', o);
            socket.emit('testing', 'hit!');
            prev = z;
            hit = false;
          }
          else{
            prev = z;
            hit = true;
          }
        }
        else{
          if(z < prev){
            socket.emit('testing', 'reset');
            prev = 0;
            hit = true;
          }
          else{
            prev = z;
            hit = false;
          }
        }
      }

    </script>
  </body>
</html>
